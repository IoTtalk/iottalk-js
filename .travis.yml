language: node_js

node_js:
  - "11"

branches:
  except:
    - gh-pages

notifications:
  email: false

script:
  - yarn run build

# https://docs.travis-ci.com/user/deployment/pages/

before_deploy:
  - export DISTDIR=/tmp/dist
  - git fetch origin gh-pages
  - git worktree add ${DISTDIR} origin/gh-pages
  - cp ./build-web/dan2-web.js ${DISTDIR}/dan2.js
  - cp ./build-web/dan2-web.js ${DISTDIR}/dan2-${TRAVIS_COMMIT}.js
  - if [ "${TRAVIS_TAG}" ]; then
      cp ./build-web/dan2-web.js ${DISTDIR}/dan2-${TRAVIS_TAG}.js;
    fi

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  keep_history: true
  local_dir: /tmp/dist
  on:
    branch:
      - master
      - /^v\d+\.\d+.\d+$/
